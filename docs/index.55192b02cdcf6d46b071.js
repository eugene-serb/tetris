(()=>{"use strict";function t(t,e){var i=t&&"number"==typeof t?t:0,n=e&&"number"==typeof e?e:0;return Math.floor(Math.random()*(n-i)+i)}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function i(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,i){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===e(o)?o:String(o)),r)}var o}const n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._value=e&&"number"==typeof e?e:0}var e,n;return e=t,(n=[{key:"value",get:function(){return this._value},set:function(t){t&&"number"==typeof t&&(this._value=t)}},{key:"increase",value:function(t){this._value+=t&&"number"==typeof t?t:1}},{key:"decrease",value:function(t){this._value-=t&&"number"==typeof t?t:1}},{key:"reset",value:function(){this._value=0}}])&&i(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==r(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===r(o)?o:String(o)),n)}var o}function a(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function s(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var l=new WeakSet,h=new WeakSet;function c(){this._timeStart=Date.now(),this._timeNow=this._timeStart,this._value="00:00"}function u(){this._timeNow=Date.now();var t=this._timeNow-this._timeStart,e=Math.floor(t/1e3),i=0;e>=60&&(e-=60*(i=Math.floor(e/60))),i=i<10?"0".concat(i):"".concat(i),e=e<10?"0".concat(e):"".concat(e),this._value="".concat(i,":").concat(e)}const f=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,h),a(this,l),s(this,l,c).call(this)}var e,i;return e=t,(i=[{key:"value",get:function(){return s(this,h,u).call(this),this._value}},{key:"reset",value:function(){s(this,l,c).call(this)}}])&&o(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,r=function(t,e){if("object"!==v(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!==v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===v(r)?r:String(r)),n)}var r}const y=function(){function t(e,i,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.EMPTY_VALUE=void 0!==n?n:0,r&&Array.isArray(r)?(this.value=this.generate(r.length,r[0].length,this.EMPTY_VALUE),this.insert(r,{x:0,y:0})):this.value=this.generate(e,i,this.EMPTY_VALUE)}var e,i;return e=t,(i=[{key:"generate",value:function(t,e,i){for(var n=t&&"number"==typeof t?Math.abs(Math.trunc(t)):1,r=e&&"number"==typeof e?Math.abs(Math.trunc(e)):1,o=void 0!==i?i:0,a=new Array,s=0;s<n;s++){a[s]=new Array;for(var l=0;l<r;l++)a[s][l]=o}return a}},{key:"clone",value:function(){return new t(null,null,this.EMPTY_VALUE,this.copy())}},{key:"copy",value:function(){for(var t=this.generate(this.value.length,this.value[0].length,this.EMPTY_VALUE),e=0;e<this.value.length;e++)for(var i=0;i<this.value[e].length;i++)t[e][i]=this.value[e][i];return t}},{key:"crop",value:function(t,e){for(var i=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y),r=this.generate(i,n,this.EMPTY_VALUE),o=0;o<i;o++)for(var a=0;a<n;a++){var s=t.x+o,l=t.y+a;r[o][a]=this.value[s][l]}this.value=r}},{key:"insert",value:function(t,e){for(var i=this.copy(),n=e.x,r=0;r<t.length;r++){for(var o=e.y,a=0;a<t[r].length;a++)i[n][o]=t[r][a],o++;n++}this.value=i}},{key:"reflectX",value:function(){this.value.reverse()}},{key:"reflectY",value:function(){this.value.forEach((function(t){t.reverse()}))}},{key:"rotateLeft",value:function(){for(var t=this.generate(this.value[0].length,this.value.length,this.EMPTY_VALUE),e=0;e<this.value.length;e++)for(var i=0;i<this.value[e].length;i++){var n=e;t[this.value[e].length-1-i][n]=this.value[e][i]}this.value=t}},{key:"rotateRight",value:function(){for(var t=this.generate(this.value[0].length,this.value.length,this.EMPTY_VALUE),e=0;e<this.value.length;e++)for(var i=0;i<this.value[e].length;i++){var n=i,r=this.value.length-1-e;t[n][r]=this.value[e][i]}this.value=t}}])&&m(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),p=JSON.parse("[[[1,1,1,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[1,1],[1,1]],[[0,1,1],[1,1,0]],[[1,1,0],[0,1,1]],[[0,1,0],[1,1,1]]]"),w=JSON.parse('[{"light":"#D93B23","dark":"#992A18"},{"light":"#D99E23","dark":"#BF8C1F"},{"light":"#FFCB5C","dark":"#FFC342"},{"light":"#02D978","dark":"#018C4D"},{"light":"#25D2E6","dark":"#23C7D9"},{"light":"#240BB3","dark":"#240BB3"},{"light":"#8932B8","dark":"#8932B8"}]');function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function d(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,r=function(t,e){if("object"!==b(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!==b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===b(r)?r:String(r)),n)}var r}function g(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function S(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var E=new WeakSet,x=new WeakSet;function T(){return new y(null,null,this.empty,S(this,x,k).call(this))}function k(){var t=this;return p[this.type].map((function(e){return e.map((function(e){return 0===e?t.empty:{exist:!0,color:{light:t.color.light,dark:t.color.dark}}}))}))}const _=function(){function t(e){var i=e.type,n=void 0===i?null:i,r=e.color,o=void 0===r?null:r,a=e.column,s=void 0===a?5:a,l=e.row,h=void 0===l?21:l,c=e.empty,u=void 0===c?null:c;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,x),g(this,E),this.type=n,this.color=w[o],this.column=s,this.row=h,this.empty=u,this.matrix=S(this,E,T).call(this)}var e,i;return e=t,(i=[{key:"toLeft",value:function(){this.column--}},{key:"toRight",value:function(){this.column++}},{key:"toDown",value:function(){this.row--}},{key:"rotateLeft",value:function(){this.matrix.rotateLeft()}},{key:"rotateRight",value:function(){this.matrix.rotateRight()}}])&&d(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function P(t){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P(t)}function M(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,r=function(t,e){if("object"!==P(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!==P(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===P(r)?r:String(r)),n)}var r}function L(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function A(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var j=new WeakSet,D=new WeakSet,C=new WeakSet;function R(){var t=this;this.$container.innerHTML="",this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.$container.appendChild(this.canvas),A(this,D,O).call(this),window.addEventListener("resize",(function(){A(t,D,O).call(t)})),this.media=window.matchMedia("(prefers-color-scheme: dark)"),A(this,C,I).call(this,this.media),this.media.addEventListener("change",(function(){A(t,C,I).call(t,t.media)}))}function O(){var t=this.matrix.length,e=this.matrix[0].length,i=e/t;this.canvas.width=0,this.canvas.height=0,this.canvas.width=this.$container.offsetWidth,this.canvas.height=this.canvas.width*i,this.cellWidth=this.canvas.width/t,this.cellHeight=this.canvas.height/e,this.draw()}function I(t){t.matches?this.theme="dark":this.theme="light",this.draw()}const W=function(){function t(e,i){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),L(this,C),L(this,D),L(this,j),!e||!i)return this.error="Error on construct",this;this.$container=e,this.matrix=i,A(this,j,R).call(this)}var e,i;return e=t,(i=[{key:"draw",value:function(){if(!this.$container||!this.matrix)return this.error;this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<this.matrix.length;t++)for(var e=0;e<this.matrix[t].length;e++)this.context.fillStyle=this.matrix[t][e].color[this.theme],this.context.fillRect(t*this.cellWidth,e*this.cellHeight,this.cellWidth,this.cellHeight)}}])&&M(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function H(t){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(t)}function Y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,r=function(t,e){if("object"!==H(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!==H(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===H(r)?r:String(r)),n)}var r}function G(t,e,i){return e&&Y(t.prototype,e),i&&Y(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var V=new WeakSet;function $(){var t=this;window.addEventListener("keydown",(function(e){t._context.isGameOver||!0===t._context.canMove&&("ArrowLeft"===e.code||"KeyA"===e.code?t._context.moveToLeft():"ArrowUp"===e.code||"KeyW"===e.code?t._context.rotate():"ArrowRight"===e.code||"KeyD"===e.code?t._context.moveToRight():"ArrowDown"!==e.code&&"KeyS"!==e.code||t._context.moveToDown()),"KeyR"===e.code&&(clearInterval(t._context.interval),t._context.start()),"KeyP"===e.code&&(t._context.isGameOver||(!0===t._context.isPaused?(t._context.interval=setInterval(t._context._eventLoop.bind(t._context),t._context.SPEED_RATE),t._context.isPaused=!1):(clearInterval(t._context.interval),t._context.isPaused=!0)))}))}const B=G((function t(e){var i,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(i=this,n=V),n.add(i),this._context=e,function(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}(this,V,$).call(this)}));function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function U(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,r=function(t,e){if("object"!==F(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!==F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===F(r)?r:String(r)),n)}var r}function z(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function K(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var N=new WeakSet,X=new WeakSet,q=new WeakSet,J=new WeakSet,Q=new WeakSet,Z=new WeakSet;function tt(){this.matrixRender=new y(null,null,this.EMPTY_CELL,this.insertTetromino(this.matrixState.copy(),this.tetromino))}function et(){this.$SCORE.innerText="Score: ".concat(this.score.value),this.$TIMER.innerText="Time: ".concat(this.timer.value),this.matrixDraw=this.matrixRender.clone(),this.matrixDraw.crop({x:0,y:0},{x:this.MAP_WIDTH,y:this.MAP_HEIGHT}),this.matrixDraw.reflectY(),this.drawer.matrix=this.matrixDraw.value,this.drawer.draw()}function it(){this.checkEndGame(),this.isGameOver&&(this.$DIALOG.innerHTML="Game Over!",clearInterval(this.interval)),this.isValidMove(this.tetromino.matrix.value,this.tetromino.column,this.tetromino.row-1)?this.tetromino.row--:(this.matrixState=new y(null,null,this.EMPTY_CELL,this.insertTetromino(this.matrixState.copy(),this.tetromino)),this.cleanRows(),this.settled=!0),this.settled&&(this.tetromino=this.getTetromino(),this.settled=!1)}function nt(){this.keyboard=new B(this)}function rt(){this.MATRIX_WIDTH=10,this.MATRIX_HEIGHT=25,this.MAP_WIDTH=10,this.MAP_HEIGHT=20,this.SPEED_RATE=250,this.EMPTY_CELL={exist:!1,color:{light:"#F5F5F5",dark:"#055159"}}}function ot(){this.$MAP=document.querySelector("#map"),this.$DIALOG=document.querySelector("#dialog"),this.$SCORE=document.querySelector("#score"),this.$TIMER=document.querySelector("#timer")}new(function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),z(this,Z),z(this,Q),z(this,J),z(this,q),z(this,X),z(this,N),K(this,Z,ot).call(this),K(this,Q,rt).call(this),K(this,J,nt).call(this),this.start()}var i,r;return i=e,(r=[{key:"getTetromino",value:function(){return new _({type:t(0,7),color:t(0,7),empty:this.EMPTY_CELL})}},{key:"checkEndGame",value:function(){var t=this;this.matrixState.value.forEach((function(e){e[19].exist&&(t.isGameOver=!0)}))}},{key:"cleanRows",value:function(){for(var t=this,e=this.matrixState.copy(),i=function(i){for(var r=0,o=0;o<e.length;o++)e[o][i].exist&&r++;10===r&&(e=e.map((function(e){return Array.prototype.concat(e.slice(0,i),e.slice(i+1,e.length),[t.EMPTY_CELL])})),t.score.increase(1),i--),n=i},n=0;n<e[0].length;n++)i(n);this.matrixState=new y(null,null,this.EMPTY_CELL,e)}},{key:"insertTetromino",value:function(t,e){for(var i=e.matrix.value,n=e.column,r=e.row,o=t,a=0;a<i.length;a++)for(var s=0;s<i[a].length;s++)i[a][s].exist&&(o[n+a][r+s]=i[a][s]);return o}},{key:"isValidMove",value:function(t,e,i){for(var n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++){if(e+n>=this.matrixState.value.length||i+r>=this.matrixState.value[0].length||e+n<0||i+r<0)return!1;if(t[n][r].exist&&this.matrixState.value[e+n][i+r].exist)return!1}return!0}},{key:"rotate",value:function(){this.tetromino.rotateRight(),this.isValidMove(this.tetromino.matrix.value,this.tetromino.column,this.tetromino.row)?K(this,X,et).call(this):this.tetromino.rotateLeft()}},{key:"moveToLeft",value:function(){this.isValidMove(this.tetromino.matrix.value,this.tetromino.column-1,this.tetromino.row)&&(this.tetromino.toLeft(),K(this,X,et).call(this))}},{key:"moveToRight",value:function(){this.isValidMove(this.tetromino.matrix.value,this.tetromino.column+1,this.tetromino.row)&&(this.tetromino.toRight(),K(this,X,et).call(this))}},{key:"moveToDown",value:function(){this.isValidMove(this.tetromino.matrix.value,this.tetromino.column,this.tetromino.row-1)&&(this.tetromino.toDown(),K(this,X,et).call(this))}},{key:"start",value:function(){this.$DIALOG.innerHTML="Let's have fun!",this.matrixState=new y(this.MATRIX_WIDTH,this.MATRIX_HEIGHT,this.EMPTY_CELL),this.matrixRender=this.matrixState.clone(),this.matrixDraw=this.matrixRender.clone(),this.matrixDraw.crop({x:0,y:0},{x:this.MAP_WIDTH,y:this.MAP_HEIGHT}),this.matrixDraw.reflectY(),this.drawer=new W(this.$MAP,this.matrixDraw.value),this.timer=new f,this.score=new n,this.isGameOver=!1,this.isPaused=!1,this.isSettled=!1,this.canMove=!0,this.tetromino=this.getTetromino(),this.interval=setInterval(this._eventLoop.bind(this),this.SPEED_RATE)}},{key:"_eventLoop",value:function(){K(this,N,tt).call(this),K(this,X,et).call(this),K(this,q,it).call(this)}}])&&U(i.prototype,r),Object.defineProperty(i,"prototype",{writable:!1}),e}())})();
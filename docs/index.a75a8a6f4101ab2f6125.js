(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,i){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===t(o)?o:String(o)),n)}var o}function i(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}const r=i((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.getRandomInteger=function(t,e){return Math.floor(Math.random()*(e-t)+t)}}));function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==n(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===n(o)?o:String(o)),r)}var o}var a=new WeakSet;function s(){this.timeNow=Date.now();var t=this.timeNow-this.timeStart,e=Math.floor(t/1e3),i=0;e>=60&&(e-=60*(i=Math.floor(e/60))),i=i<10?"0".concat(i):"".concat(i),e=e<10?"0".concat(e):"".concat(e),this.time="".concat(i,":").concat(e)}const h=function(){function t(e){var i,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(i=this,r=a),r.add(i),this.$container=e,this.time="00:00",this.timeStart=Date.now(),this.timeNow=this.timeStart}var e,i;return e=t,(i=[{key:"draw",value:function(){(function(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i})(this,a,s).call(this),this.$container.innerText="Time: ".concat(this.time)}}])&&o(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function l(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==c(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===c(n)?n:String(n)),r)}var n}const u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$container=e,this.balance=0}var e,i;return e=t,(i=[{key:"increase",value:function(t){this.balance+=t,this.draw()}},{key:"draw",value:function(){this.$container.innerText="Score: ".concat(this.balance)}}])&&l(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function m(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==f(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===f(n)?n:String(n)),r)}var n}function y(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function v(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var p=new WeakSet,b=new WeakSet,w=new WeakSet;function d(){var t=this;this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.$container.appendChild(this.canvas),v(this,b,g).call(this),window.addEventListener("resize",(function(){v(t,b,g).call(t)})),this.media=window.matchMedia("(prefers-color-scheme: dark)"),v(this,w,S).call(this,this.media),this.media.addEventListener("change",(function(){v(t,w,S).call(t,t.media)}))}function g(){this.canvas.width=0,this.canvas.height=0,this.ratio=this.mapHeight/this.mapWidth,this.canvas.width=this.$container.offsetWidth,this.canvas.height=this.canvas.width*this.ratio,this.cellWidth=this.canvas.width/this.mapWidth,this.cellHeight=this.canvas.height/this.mapHeight,this.draw()}function S(t){t.matches?(this.color_canvas="#055159",this.color_cells="#0DC4D9"):(this.color_canvas="#F5F5F5",this.color_cells="#0DC4D9"),this.draw()}const x=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),y(this,w),y(this,b),y(this,p),this.$container=e,this.matrix=i,this.mapWidth=i.length,this.mapHeight=i[0].length,v(this,p,d).call(this),this.draw()}var e,i;return e=t,(i=[{key:"draw",value:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color_canvas,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color_cells;for(var t=0;t<this.mapWidth;t++)for(var e=0;e<this.mapHeight;e++)0!==this.matrix[t][e]&&this.context.fillRect(t*this.cellWidth,e*this.cellHeight,this.cellWidth,this.cellHeight)}}])&&m(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function T(t){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T(t)}function P(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==T(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==T(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===T(n)?n:String(n)),r)}var n}const E=function(){function t(e){var i=e.width,r=void 0===i?null:i,n=e.height,o=void 0===n?null:n,a=e.matrix,s=void 0===a?null:a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s?(this.width=s.length,this.height=s[0].length,this.matrix=s):(this.width=r,this.height=o,this.matrix=this.generate(this.width,this.height))}var e,i;return e=t,(i=[{key:"generate",value:function(t,e){for(var i=new Array,r=0;r<t;r++){i[r]=new Array;for(var n=0;n<e;n++)i[r][n]=0}return i}},{key:"clone",value:function(){for(var e=this.generate(this.matrix.length,this.matrix[0].length),i=0;i<this.matrix.length;i++)for(var r=0;r<this.matrix[i].length;r++)e[i][r]=this.matrix[i][r];return new t({matrix:e})}},{key:"copy",value:function(){for(var t=this.generate(this.matrix.length,this.matrix[0].length),e=0;e<this.matrix.length;e++)for(var i=0;i<this.matrix[e].length;i++)t[e][i]=this.matrix[e][i];return t}},{key:"crop",value:function(t){for(var e=Math.abs(t[1][0]-t[0][0]),i=Math.abs(t[1][1]-t[0][1]),r=this.generate(e,i),n=0;n<e;n++)for(var o=0;o<i;o++){var a=t[0][0]+n,s=t[0][1]+o;r[n][o]=this.matrix[a][s]}return r}},{key:"insert",value:function(t,e,i){for(var r=this.copy(),n=e,o=0;o<t.length;o++){for(var a=i,s=0;s<t[0].length;s++)r[n][a]=t[o][s],a++;n++}return r}},{key:"reflectX",value:function(){return this.copy().reverse()}},{key:"reflectY",value:function(){for(var t=this.generate(this.matrix.length,this.matrix[0].length),e=0;e<this.matrix.length;e++)t[e]=this.matrix[e].reverse();return t}},{key:"rotateLeft",value:function(){for(var t=this.generate(this.matrix[0].length,this.matrix.length),e=0;e<this.matrix.length;e++)for(var i=0;i<this.matrix[e].length;i++){var r=e;t[this.matrix[e].length-1-i][r]=this.matrix[e][i]}return t}},{key:"rotateRight",value:function(){for(var t=this.generate(this.matrix[0].length,this.matrix.length),e=0;e<this.matrix.length;e++)for(var i=0;i<this.matrix[e].length;i++){var r=i,n=this.matrix.length-1-e;t[r][n]=this.matrix[e][i]}return t}}])&&P(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function j(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==k(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===k(n)?n:String(n)),r)}var n}function W(t,e,i){return e&&j(t.prototype,e),i&&j(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}var R=[[[1,1,1,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[1,1],[1,1]],[[0,1,1],[1,1,0]],[[1,1,0],[0,1,1]],[[0,1,0],[1,1,1]]],I=["cyan","yellow","purple","green","red","blue","orange"];const A=W((function t(e){var i=e.type,r=e.color,n=e.column,o=void 0===n?5:n,a=e.row,s=void 0===a?21:a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.matrix=R[i],this.color=I[r],this.column=o,this.row=s}));function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function D(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==M(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===M(n)?n:String(n)),r)}var n}function H(t,e){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.add(t)}function _(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var C=new WeakSet,O=new WeakSet,$=new WeakSet,G=new WeakSet,K=new WeakSet,L=new WeakSet,X=new WeakSet,q=new WeakSet,z=new WeakSet,N=new WeakSet;function F(){this.matrixState=new E({width:this.MATRIX_WIDTH,height:this.MATRIX_HEIGHT}),this.matrixRender=this.matrixState.clone(),this.matrixDraw=this.matrixRender.crop([[0,0],[this.MAP_WIDTH,this.MAP_HEIGHT]]),this.map=new x(this.$MAP,this.matrixDraw),this.support=new r,this.timer=new h(this.$TIMER),this.score=new u(this.$SCORE),this.isPaused=!1,this.isSettled=!1,this.canMove=!0,this.tetromino=this.generateTetromino(),this.interval=setInterval(_(this,O,Y).bind(this),this.SPEED_RATE)}function Y(){_(this,$,U).call(this),_(this,G,B).call(this),_(this,K,J).call(this),_(this,L,Q).call(this)}function U(){this.tetromino.row--}function B(){this.matrixRender=new E({matrix:this.matrixState.copy()});var t=this.matrixRender.insert(this.tetromino.matrix,this.tetromino.column,this.tetromino.row);this.matrixRender=new E({matrix:t})}function J(){this.matrixDraw=new E({matrix:this.matrixRender.crop([[0,0],[this.MAP_WIDTH,this.MAP_HEIGHT]])}),this.matrixDraw.matrix=this.matrixDraw.reflectY(),this.map.matrix=this.matrixDraw.matrix,this.timer.draw(),this.score.draw(),this.map.draw()}function Q(){if(0===this.tetromino.row){var t=this.matrixState.insert(this.tetromino.matrix,this.tetromino.column,this.tetromino.row);this.matrixState=new E({matrix:t}),this.settled=!0}this.settled&&(this.tetromino=this.generateTetromino(),this.settled=!1)}function V(){this.MATRIX_WIDTH=10,this.MATRIX_HEIGHT=25,this.MAP_WIDTH=10,this.MAP_HEIGHT=20,this.SPEED_RATE=500}function Z(){this.$MAP=document.querySelector("#map"),this.$SCORE=document.querySelector("#score"),this.$TIMER=document.querySelector("#timer"),this.$RATING=document.querySelector("#rating")}function tt(){_(this,N,et).call(this)}function et(){var t=this;window.addEventListener("keydown",(function(e){!0===t.canMove&&("ArrowLeft"===e.code||"KeyA"===e.code||"ArrowUp"===e.code||"KeyW"===e.code||"ArrowRight"===e.code||"KeyD"===e.code||"ArrowDown"===e.code||e.code),"KeyR"===e.code&&(clearInterval(t.interval),_(t,C,F).call(t)),"KeyP"===e.code&&(!0===t.isPaused?(t.interval=setInterval(_(t,O,Y).bind(t),t.SPEED_RATE),t.isPaused=!1):(clearInterval(t.interval),t.isPaused=!0))}))}new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),H(this,N),H(this,z),H(this,q),H(this,X),H(this,L),H(this,K),H(this,G),H(this,$),H(this,O),H(this,C),_(this,q,Z).call(this),_(this,X,V).call(this),_(this,z,tt).call(this),_(this,C,F).call(this)}var e,i;return e=t,(i=[{key:"generateTetromino",value:function(){return new A({type:this.support.getRandomInteger(0,7),color:this.support.getRandomInteger(0,7)})}}])&&D(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}())})();